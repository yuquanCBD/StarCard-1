<!DOCTYPE html>

<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->

<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->

<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->

<!-- BEGIN HEAD -->

<head>

	<meta charset="utf-8" />

	<title>信息查询</title>

	<meta content="width=device-width, initial-scale=1.0" name="viewport" />

	<meta content="" name="description" />

	<meta content="" name="author" />

	<!-- BEGIN GLOBAL MANDATORY STYLES -->

	<link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

	<link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>

	<link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>

	<link href="media/css/style-metro.css" rel="stylesheet" type="text/css"/>

	<link href="media/css/style.css" rel="stylesheet" type="text/css"/>

	<link href="media/css/style-responsive.css" rel="stylesheet" type="text/css"/>

	<link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>

	<link href="media/css/uniform.default.css" rel="stylesheet" type="text/css"/>

	<!-- END GLOBAL MANDATORY STYLES -->

	<!-- BEGIN PAGE LEVEL STYLES -->

	<link rel="stylesheet" type="text/css" href="media/css/select2_metro.css" />

	<link rel="stylesheet" href="media/css/DT_bootstrap.css" />

	<!-- END PAGE LEVEL STYLES -->

	<link rel="shortcut icon" href="media/image/favicon.ico" />

</head>

<!-- END HEAD -->

<!-- BEGIN BODY -->

<body class="page-header-fixed">

	<!-- BEGIN HEADER -->

	<div class="header navbar navbar-inverse navbar-fixed-top">

		<!-- BEGIN TOP NAVIGATION BAR -->

		<div class="navbar-inner">

			<div class="container-fluid">

				<!-- BEGIN LOGO -->

				<a class="brand" href="query">

				<img src="media/image/logo.png" alt="logo" />

				</a>

				<!-- END LOGO -->

				<!-- BEGIN RESPONSIVE MENU TOGGLER -->

				<a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">

				<img src="media/image/menu-toggler.png" alt="" />

				</a>          

				<!-- END RESPONSIVE MENU TOGGLER -->            

				<!-- BEGIN TOP NAVIGATION MENU -->              
<!-- -->

				<!-- END TOP NAVIGATION MENU --> 

			</div>

		</div>

		<!-- END TOP NAVIGATION BAR -->

	</div>

	<!-- END HEADER -->

	<!-- BEGIN CONTAINER -->

	<div class="page-container row-fluid">

		<!-- BEGIN SIDEBAR -->

		<div class="page-sidebar nav-collapse collapse">

			<!-- BEGIN SIDEBAR MENU -->        

			
			<ul class="page-sidebar-menu">
				<li class="">

					<a href="javascript:;">

					<i class="icon-table"></i> 

					<span class="title">球星卡管理</span>

					<span class="selected"></span>

					<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li class="">

							<a href="/admin/managerquery">

							 管理员卡片管理</a>

						</li>
						<li class="">

							<a href="/admin/commonquery">

							 普通商家卡片管理</a>

						</li>

						<li class="">

							<a href="/admin/starcardAdd">

							信息添加</a>

						</li>


					</ul>

				</li>

				<li class="active">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">人员管理</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li class="active">

							<a href="/webUser/query">人员查询、删除、修改</a>

						</li>

						<li class="">

							<a href="/webUser/add">人员增加</a>

						</li>
						<li class="">

							<a href="/webUser/getmanager">管理员管理</a>

						</li>


					</ul>

				</li>
				<li class="">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">订单管理</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li>
							<a href="/webOrder/query">订单查询、删除、修改</a>
						</li>
						<li>
							<a href="/webOrder/managerquery">管理员用户订单管理</a>
						</li>
						<li>
							<a href="/webOrder/commonquery">普通用户订单管理</a>
						</li>

					</ul>

				</li>
				<li class="">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">百科管理</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li>
							<a href="/webWiki/add">百科增加</a>
						</li>
						<li>
							<a href="/webWiki/query">百科查询、删除、修改</a>
						</li>
						<li>
							<a href="/webWiki/check">百科审核</a>
						</li>
						<li>
							<a href="/webWiki/lock">百科锁定</a>
						</li>
					</ul>

				</li>
				<li class="">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">新闻管理</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li>
							<a href="/kindeditor/nodejs/newsAdd.html">新闻增加</a>
						</li>
						<li>
							<a href="/kindeditor/nodejs/newsManage.html">新闻查询、删除、修改</a>
						</li>
					</ul>

				</li>
				<li class="">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">消息推送</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li class="">
							<a href="/webNews/message">消息推送</a>
						</li>
						<li class="">
							<a href="/webNews/messagelist">消息管理</a>
						</li>
					</ul>

				</li>
				<li class="">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">广告管理</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li class="">
							<a href="/kindeditor/nodejs/advAdd.html">广告增加</a>
						</li>
						<li class="">
							<a href="/kindeditor/nodejs/advManage.html">广告查询、删除、修改</a>
						</li>
					</ul>

				</li>
				<li class="">

					<a href="javascript:;">

						<i class="icon-table"></i> 

						<span class="title">客服信息</span>

						<!-- <span class="selected"></span> -->

						<span class="arrow open"></span>

					</a>

					<ul class="sub-menu">
						<li class="">
							<a href="/webService/checksv">未处理客服信息</a>
						</li>
						<li class="">
							<a href="/webService/allsv">所有客服信息</a>
						</li>
					</ul>

				</li>


			</ul>
			<!-- END SIDEBAR MENU -->

		</div>

		<!-- END SIDEBAR -->

		<!-- BEGIN PAGE -->

		<div class="page-content">

			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->

			<div id="portlet-config" class="modal hide">

				<div class="modal-header">

					<button data-dismiss="modal" class="close" type="button"></button>

					<h3>portlet Settings</h3>

				</div>

				<div class="modal-body">

					<p>Here will be a configuration form</p>

				</div>

			</div>

			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->

			<!-- BEGIN PAGE CONTAINER-->        

			<div class="container-fluid">

				<!-- BEGIN PAGE HEADER-->

				<div class="row-fluid">

					<div class="span12">
						<!-- BEGIN PAGE TITLE & BREADCRUMB-->

						<h3 class="page-title">

							信息查询、删除、添加

						</h3>

						<!-- END PAGE TITLE & BREADCRUMB-->

					</div>

				</div>

				<!-- END PAGE HEADER-->

				<!-- BEGIN PAGE CONTENT-->

				<div id="query" class="row-fluid">

					<div class="span6 responsive" style="width:100%" data-tablet="span12 fix-offset" data-desktop="span6">

						<!-- BEGIN EXAMPLE TABLE PORTLET-->

						<div class="portlet grey">

							<div class="portlet-title">

								<div class="caption"><i class="icon-user"></i>人员信息查询结果</div>

								<div class="actions">

									<!-- <a href="/admin/query" class="btn blue"> 查询球星卡信息</a> -->

								</div>

							</div>

							<div  class="portlet-body">

								<table class="table table-striped table-bordered table-hover" id="sample_2">

									<thead>

										<tr>
											<th>序号</th>
											<th class="hidden-480">用户id</th>
											<th class="hidden-480">用户名</th>
											<th class="hidden-480">性别</th>
											<th class="hidden-480">邮箱</th>
											<th class="hidden-480">手机</th>
											<th class="hidden-480">积分</th>
											<th class="hidden-480">身份信息</th>
											<th class="hidden-480">删除</th>
											<th class="hidden-480">修改</th>
											<th class="hidden-480">禁言</th>
											<th class="hidden-480">解除禁言</th>
										</tr>

									</thead>

									<tbody>

									</tbody>

								</table>
								
							</div>

						</div>

						<!-- END EXAMPLE TABLE PORTLET-->

					</div>

					

				</div>

				

				<!-- END PAGE CONTENT-->
				<!-- ************************************************************** -->
				<!-- BEGIN PAGE CONTENT-->

				<div id='update' class="row-fluid" hidden=true>

					<div class="span12">

						<!-- BEGIN SAMPLE FORM PORTLET-->   

						<div class="portlet box blue tabbable">

							<div class="portlet-title">

								<div class="caption">

									<i class="icon-reorder"></i>

									<span class="hidden-480">修改卡片信息列表</span>

								</div>

							</div>

							<div class="portlet-body form">

								<div class="tabbable portlet-tabs">

									<ul class="nav nav-tabs">

										<li><a href="">信息修改</a></li>
									</ul>

									<div class="tab-content">

										<div class="tab-pane active" id="portlet_tab1">

											<!-- BEGIN FORM-->

											<form id='formUpdate' action="/webUser/update" enctype="multipart/form-data" method="post" class="form-horizontal">

												<div hidden class="control-group">

													<label class="control-label" >用户id</label>

													<div class="controls">

														<input id='userid' type="text" class="m-wrap meduium" name="userid" />

														<!-- <span class="help-inline">Some hint here</span> -->

													</div>

												</div>
												<div class="control-group">

													<label class="control-label" >用户名:</label>

													<div class="controls">

														<input id='username' type="text" class="m-wrap meduium" name="username" />

													</div>

												</div> 

												<div class="control-group">

													<label class="control-label">电子邮件:</label>

													<div class="controls">

														<input id='email' type="text"  class="m-wrap medium" name="email" />
														<!-- <span class="help-inline">Some hint here</span> -->

													</div>

												</div>

												<div class="control-group">

													<label class="control-label">联系方式:</label>

													<div class="controls">

														<input id='telephone' type="text" class="m-wrap medium" name="telephone" />

														<span class="help-inline">(手机号)</span>

													</div>

												</div>
												<div class="control-group">

													<label class="control-label">积分:</label>

													<div class="controls">

														<input id='score' type="text" class="m-wrap medium" name="score" />

														<span class="help-inline">(数字)</span>

													</div>

												</div>
												<div class="control-group">

													<label class="control-label">身份证后四位:</label>

													<div class="controls">

														<input id='IDCardNo' type="text" class="m-wrap medium" name="IDCardNo" />

														<span class="help-inline">(身份证最后一位为x的输入后五位的前四位)</span>

													</div>

												</div>

												<div class="control-group">

													<label class="control-label">性别:</label>

													<div class="controls">

														<select id='gender' class="small m-wrap"  name="gender">

															<option value="0">女</option>
															<option value="1">男</option>

														</select>

													</div>

												</div>

												<div class="control-group">

													<label class="control-label">用户头像:</label>

													<div id="userImg" class="controls">
														<!-- <input class="medium m-wrap" type="file" name="imgs" multiple="multiple">
														<span class="help-inline">最多三张</span> -->
														<!-- <img src="../0.jpg" height="100" width="100">
														<img src="../0.jpg" height="100" width="100">
														<img src="../1.jpg" height="100" width="100"> -->
													</div>

												</div>
												<div class="control-group">

													<label class="control-label">用户头像更改:</label>

													<div class="controls">
														<input class="medium m-wrap" type="file" name="imgs" multiple="multiple">
														<span class="help-inline">(最多一张,不更换头像不要上传)</span>
													</div>

												</div>

												<div class="form-actions">

													<button id="updateSubmit" type="submit" class="btn blue"><i class="icon-ok"></i> 用户信息修改</button>
													<!-- <button type="button" class="btn">取消</button> -->

												</div>

											</form>

											<!-- END FORM-->  

										</div>

									</div>

								</div>

							</div>

						</div>

						<!-- END SAMPLE FORM PORTLET-->

					</div>

				</div>

				<!-- END PAGE CONTENT-->         

				<!-- ************************************************************** -->
			</div>

			<!-- END PAGE CONTAINER-->

		</div>

		<!-- END PAGE -->

	</div>

	<!-- END CONTAINER -->

	<!-- BEGIN FOOTER -->

	<div id='sss' class="footer">

		<div id='sssss' class="footer-inner">

			2013 &copy; Metronic by keenthemes.

		</div>

		<div class="footer-tools">

			<span class="go-top">

			<i class="icon-angle-up"></i>

			</span>

		</div>

	</div>

	<!-- END FOOTER -->

	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->

	<!-- BEGIN CORE PLUGINS -->

	<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>

	<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>

	<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->

	<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>      

	<script src="media/js/bootstrap.min.js" type="text/javascript"></script>

	<!--[if lt IE 9]>

	<script src="media/js/excanvas.min.js"></script>

	<script src="media/js/respond.min.js"></script>  

	<![endif]-->   

	<script src="media/js/jquery.slimscroll.min.js" type="text/javascript"></script>

	<script src="media/js/jquery.blockui.min.js" type="text/javascript"></script>  

	<script src="media/js/jquery.cookie.min.js" type="text/javascript"></script>

	<script src="media/js/jquery.uniform.min.js" type="text/javascript" ></script>

	<!-- END CORE PLUGINS -->

	<!-- BEGIN PAGE LEVEL PLUGINS -->

	<script type="text/javascript" src="media/js/select2.min.js"></script>

	<script type="text/javascript" src="media/js/jquery.dataTables.js"></script>

	<script type="text/javascript" src="media/js/DT_bootstrap.js"></script>

	<!-- END PAGE LEVEL PLUGINS -->

	<!-- BEGIN PAGE LEVEL SCRIPTS -->

	<script src="media/js/app.js"></script>

	<script src="media/js/table-managed.js"></script>     

	<script>
		/*
		<th class="hidden-480">username</th>
		<th class="hidden-480">IDCardNo</th>
		<th class="hidden-480">telephone</th>
		<th class="hidden-480">email</th>
		<th class="hidden-480">score</th>
		<th class="hidden-480">gender</th>
		index  username  gender  email  telephone  score  IDCardNo  
		*/

		jQuery(document).ready(function() {     
			function createTR(obj,index){
				console.log(obj.userid);
				var tr = '<tr class="odd gradeX">'+
					//'<td><input type="checkbox" class="checkboxes" value="1" name="checks"/></td>'+
					'<td>'+index+'</td>'+
					'<td>'+obj.userid+'</td>'+
					'<td>'+obj.username+'</td>';
				if(obj.gender == 1){
					tr += '<td>男</td>';
				}
				else{
					tr += '<td>女</td>';
				};
				tr +=
					'<td>'+obj.email+'</td>'+
					'<td>'+obj.telephone+'</td>'+
					'<td>'+obj.score+'</td>'+
					'<td>'+obj.IDCardNo+'</td>'+
					//'<td><a href="#" cardId="'+obj.cardId+'" onclick="beSure()">delete</a></td>'+
					'<td><button userId="'+obj.userid+'" class="deleteButton">删除</button></td>'+
					'<td><button userId="'+obj.userid+'" pictures="'+obj.portrait+'" class="updateButton">修改</button></td>';
				if(obj.shutup == 0){
					tr += '<td><button userId="'+obj.userid+'" class="shutup">禁言</button></td>'+'<td><button disabled userId="'+obj.userid+'" class="talk">解除禁言</button></td></tr>';
				}
				else{
					tr += '<td><button disabled userId="'+obj.userid+'" class="shutup">禁言</button></td>'+'<td><button userId="'+obj.userid+'" class="talk">解除禁言</button></td></tr>';
				}
				return tr;
			};
			
			function PostAjax(url, obj){
				$.ajax({
			   		type : 'POST',
			   		url : url,
			   		data : obj,
			   		dataType : 'json',
			   		cache : false,
			   		success : function(data){
			   			location.reload();
			   		},
			   		error : function(){
			   			console.log('数据库操作失败');
			   		}
		   		}); 
			};
			function updateAjax(url, obj){
				console.log(url);
				console.log(obj);
				$.ajax({
			   		type : 'POST',
			   		url : url,
			   		data : obj,
			   		dataType : 'json',
			   		cache : false,
		   		});
			}
			function query(){
				$.ajax({
			   		type : 'POST',
			   		url : '/webUser/query',
			   		data : {pageIndex : 0, pageSize : 20},
			   		dataType : 'json',
			   		cache : false,
			   		success : function(data){
			   			var eva = eval(data);
			   			console.log(eva.length);
			   			console.log(eva);
			   			$('tbody').empty();
			   			for (var i = 0; i < eva.length; i++) {
			  				var tr = createTR(eva[i],i+1);
			   				$('tbody').append(tr);
			   			};
			   			$("button.deleteButton").click(function(e){
			   				if(confirm('是否需要删除?')){
			   					var cid = $(e.target).attr('userId');
			   					console.log(cid);
			   					PostAjax('/webUser/delete',{userid:cid});
			   				}
			   			});
			   			$("button.shutup").click(function(e){
			   				var cid = $(e.target).attr('userId');
			   				PostAjax('/webUser/shutup',{userid:cid,shutup:1});
			   			});
			   			$("button.talk").click(function(e){
			   				var cid = $(e.target).attr('userId');
			   				PostAjax('/webUser/shutup',{userid:cid,shutup:0});
			   			});
			   			/*index  username  gender  email  telephone  score  IDCardNo*/
			   			$("button.updateButton").click(function(e){
			   				if(confirm('是否需要修改卡信息?')){
			   					$('div#update').attr('hidden',false);
			   					$('div#query').attr('hidden',true);
			   					var userid = $(e.target).attr('userId');
			   					var pictures = $(e.target).attr('pictures');
			   					var tr = $(e.target).parent().parent();
			   					var tds = $(tr).find('td');
			   					//console.log($(tds[1]).text());
			   					var username = $(tds[2]).text();
			   					var gender = $(tds[3]).text();
			   					var email = $(tds[4]).text();
			   					var telephone = $(tds[5]).text();
			   					var score = $(tds[6]).text();
			   					var IDCardNo = $(tds[7]).text();

			   					$('div#user').attr('hidden',false);
			   					$('div#query').attr('hidden',true);
			   					$('input#userid').attr('value',userid);
			   					$('input#username').attr('value',username);
			   					$('input#username').attr('disabled',true);
			   					$('input#email').attr('value',email);
			   					$('input#telephone').attr('value',telephone);
			   					$('input#score').attr('value',score);
			   					$('input#IDCardNo').attr('value',IDCardNo);
			   					var options = $('#gender').find('option');
			   					// for (var i = 0; i < options.length; i++) {
			   					// 	if($(options[i]).text() == category){
			   					// 		$(options[i]).attr('selected',1);
			   					// 	}
			   					// };
			   					if(gender == "男"){
			   						$(options[1]).attr("selected",1);
			   					}
			   					else{
			   						$(options[0]).attr("selected",1);
			   					};

			   					var strs = pictures.split(',');
			   					console.log('strs: ',strs[0]);
			   					//<img src="../0.jpg" height="100" width="100">
			   					$("#userImg").empty();
			   					if(strs[0] != ''){
			   						for(var i=0;i<strs.length;i++){
			   						$('#userImg').append('<img src="../'+strs[i]+'" height="100" width="100">');
			   						};
			   					}
			   					else{
			   						$('#userImg').append('<span class="help-inline">没有图片</span>');
			   					}
			   				
			   					
			   					//updateAjax('update',{flag:'hahhahah'});
			   					// var tds = tr.getElementsByTagName('td');
			   					// console.log(tds.length);
			   				}
			   			})
			   			App.init();

			   			TableManaged.init();
			   		},
			   		error : function(){
			   			alert('查询信息失败');
			   		}
		   		});    
			}
		 	query();
		 	$('#updateSubmit').click(function(e){
		 		var IDCardNo = $("input#IDCardNo").attr("value");
		   		//var username = $('input#username').attr('value');
				var email = $('input#email').attr('value');
				var telephone = $('input#telephone').attr('value');
				var score = $('input#score').attr('value');
				console.log(IDCardNo,',',email,',',telephone,',',score);
				if(!IDCardNo || !email || !telephone || !score){
		   			alert("请完整输入信息");
		   			return false;
		   		}
				if(confirm('是否确认修改信息?')){
					return true;
				}
				else{
					//console.log('点击');
					$('div#update').attr('hidden',true);
					$('div#query').attr('hidden',false);

					return false;
				}
				
			});
		 	$("#detailBtn").click(function(){
				$('#checks').each(function(){
					if(this.checked)
						alert($(this).val());
				});
			});

		});

	</script>

<script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-37564768-1']);  _gaq.push(['_setDomainName', 'keenthemes.com']);  _gaq.push(['_setAllowLinker', true]);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();</script></body>

<!-- END BODY -->

</html>